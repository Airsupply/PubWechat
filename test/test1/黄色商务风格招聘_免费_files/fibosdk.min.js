"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fiboSDK=function(){var c,t,n,e,a=0,r=(new Date).getTime(),s=0,d=0,p=0,u="https://sdkapi.fibodata.com/init",h="https://sdkapi.fibodata.com/log",g="https://sdkapi.fibodata.com/logs",v="https://sdkapi.fibodata.com/delayLogs",i="//kwres.killerwhale.cn/mkcloudsdk/js/card.js",o=!1,l=[],m={},f=window.screen.width||0,y=window.screen.height||0,w=window.devicePixelRatio||0,x=Math.max(f,y)*w<=2560?(window.screen.width||0)*(window.devicePixelRatio||0)+"x"+(window.screen.height||0)*(window.devicePixelRatio||0):(window.screen.width||0)+"x"+(window.screen.height||0),b=function(){function e(){this.dataType="json",this.statusCode=null,this.xhr=this.createXHR()}return e.prototype.fn=function(){},e.prototype.createXHR=function(){var e;return(e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveObject("Microsoft.XMLHTTP")).onreadystatechange=this.readyStateChange.bind(this),e},e.prototype.request=function(e){var t,n,i,o;return e&&"object"===(void 0===e?"undefined":_typeof(e))&&(this.dataType=e.dataType||"json",o=e.contentType||null,n=e.type.toUpperCase()||"GET",i=e.url,t=e.data||null,this.success=e.success||this.fn,this.error=e.error||this.fn,"GET"===n?(t?(t=this.serialize(t)).toString()&&(i+=(0<=i.indexOf("?")?"&":"?")+t):(t=Math.floor(1e8*Math.random())).toString()&&(i+=(0<=i.indexOf("?")?"&":"?")+t),this.xhr.open(n,i,!0)):"POST"===n&&(this.xhr.open(n,i,!0),o&&"application/json"===o?(this.xhr.setRequestHeader("Content-type","application/json;charset=utf-8"),"object"===(void 0===t?"undefined":_typeof(t))&&(t=JSON.stringify(t))):(!t||t instanceof FormData||this.xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded;charset=utf-8"),t=this.serialize(t))),e.timeout&&(this.xhr.timeout=e.timeout,this.xhr.ontimeout=e.error),this.xhr.send(t)),this},e.prototype.serialize=function(e){return"object"!==(void 0===e?"undefined":_typeof(e))||e instanceof FormData||(e=this.params(e)),e},e.prototype.readyStateChange=function(){var e,t,n;if(4===(n=this.xhr).readyState)if(200<=(t=n.status)&&t<=300||304==t){try{e="json"===this.dataType?JSON.parse(n.responseText):n.responseText}catch(e){return void this.error(e)}this.success(e)}else this.error(n.responseText,t)},e.prototype.get=function(e,t,n,i,o,r){var a;return a={type:"GET",url:e,data:t,dataType:n,timeout:i,success:o,error:r},this.request(a)},e.prototype.post=function(e,t,n,i,o,r,a){var s;return s={type:"POST",url:e,data:t,dataType:n,contentType:i,timeout:o,success:r,error:a},this.request(s)},e.prototype.params=function(e,t){var n,i,o,r;if("object"!==(void 0===e?"undefined":_typeof(e)))return"";for(i in o=[],e)e.hasOwnProperty(i)&&(n=t?t+"["+i+"]":i,r="object"===(void 0===(r=e[i])?"undefined":_typeof(r))?r instanceof Date||r instanceof String||r instanceof Number?encodeURIComponent(n)+"="+encodeURIComponent(r.toString()):this.params(r,n):(r=null==r?"":encodeURIComponent(r.toString()),encodeURIComponent(n)+"="+r),o.push(r));return o.join("&")},e}(),E=E||(c=function(e){return e&&"function"==typeof e},(t=function e(t){if(t&&!c(t))throw new TypeError("The first promise resolver must be resolver");if(!(this instanceof e))return new e(t);var n=this;n._value,n._error,n._status="PENDING",n._resolves=[],n._rejects=[];t&&t(function(e){for(var t;n._resolves.length;)(t=n._resolves.shift())&&(e=t.call(n,e)||e);n._value=e,n._resolves=[],n._status="RESOLVED"},function(e){for(var t;n._rejects.length;)(t=n._rejects.shift())&&(e=t.call(n,e)||e);n._error=e,n._rejcts=[],n._status="REJECTED"})}).prototype.then=function(r,a){var s=this;return t(function(i,o){function e(e){var t,n=c(r)&&r(e)||e;(t=n)&&"function"==typeof t.then?n.then(function(e){i(e)},function(e){o(e)}):i(n)}function t(e){c(a)&&a(e),o(e)}var n=s._status;"PENDING"===n?(s._resolves.push(e),s._rejects.push(t)):"RESOLVED"===n?e(s._value):"REJECTED"===n&&t(s._error)})},t.all=function(c){if(e=c,"[object Array]"!==Object.prototype.toString.call(e))throw new TypeError("You must pass an array to all.");var e;return t(function(n,t){var i=[],o=c.length,r=0;function e(t){return function(e){i[t]=e,++r===o&&n(i)}}function a(e){t(e)}for(var s=0;s<o;s++)c[s].then(e(s),a)})},t.prototype.catch=function(e){return this.then(void 0,e)},t),T=function(e){var p=window&&window.navigator&&window.navigator.userAgent;if(!p)return{};var t=function(e){var t="pc",n="";if(/iPhone/i.test(p))t="iphone",/iPhone OS ([^ ;]*)/.test(p)&&(n=RegExp.$1.replace(/_/g,"."));else if(/(iPad|iPod)/i.test(p))t="ipad",/iPhone OS ([^ ;]*)/.test(p)&&(n=RegExp.$1.replace(/_/g,"."));else if(/Android/i.test(p))t="android",/Android ([^ ;]*)/.test(p)&&(n=RegExp.$1);else if(/Windows Phone/i.test(p))t="WP";else if(/Windows/i.test(p)){if(t="Windows",/Windows NT (\d+\.*\d*)/.test(p))switch(RegExp.$1){case"10.0":case"10":n="10";break;case"6.4":n="10技术预览版";break;case"6.3":n="8.1";break;case"6.2":n="8";break;case"6.1":n="7";break;case"6.0":n="vista";break;case"5.2":case"5.1":n="xp"}}else/Mac OS X/.test(p)?(t="Mac",/Mac OS X ([^ ;]*)/.test(p)&&(n=RegExp.$1.replace(/_/g,"."))):(/X11/.test(p)||/Linux/.test(p))&&(t="Linux");var i,o="",r="",a="";if("android"===t){o=/GT-|SM-|SCH-/gi.test(i=e)?"samsung":/HM|RedMi|Mi|MIX/gi.test(i)?"xiaomi":/HUAWEI|HONOR/gi.test(i)?"Huawei":/vivo/gi.test(i)?"vivo":/Meitu|MP/gi.test(i)?"Meitu":/OPPO|R6|R7|R8/gi.test(i)?"OPPO":/Coolpad|SK1/gi.test(i)?"Coolpad":/ASUS/gi.test(i)?"ASUS":/ZTE/gi.test(i)?"ZTE":/HTC/gi.test(i)?"HTC":/Sony/gi.test(i)?"Sony":/Lenovo/gi.test(i)?"Lenovo":/NX5/gi.test(i)?"nubia":/SM|YQ/gi.test(i)?"Smartisan":/m([0-9cx]{1,4})/gi.test(i)||/PRO 5/g.test(i)?"meizu":"UNKOWN";var s,c,d=e&&e.search("Build");-1!==d&&(s=e&&e.substr(0,d).split(";"),c=e&&e.substr(d).split(";")),s&&" "===(r=s[s.length-1])[0]&&(r=r.substr(1)),c&&(a=c[0].split("/")[1])}else"iphone"===t?(o="iphoneOther",320===f&&(480===y&&(o=2===w?"iphone4x":"iphoneOther"),568===y&&(o="iphone5x")),375===f&&(667===y?o="iphone6x":812===y&&(o="iphoneX")),414===f&&(o="iphone6xp")):"pc"!==t&&"Windows"!==t&&"Mac"!==t&&"Linux"!==t||(/se\s(2\.x)/gi.test(p)?(o="sougou",r=RegExp.$1):/LBBROWSER/gi.test(p)?o="liebao":/qqbrowser\/([^\s;]*)/gi.test(p)?(o="qq",r=RegExp.$1):/UBrowser\/([^\s;]*)/gi.test(p)?(o="uc",r=RegExp.$1):/Maxthon\/([^\s;]*)/gi.test(p)?(o="maxthon",r=RegExp.$1):/360se/gi.test(p)?o="360se":/360ee/gi.test(p)?o="360ee":/BIDUBrowser|BaiduHD\s([^\s;]*)/gi.test(p)?(o="baidu",r=RegExp.$1):/TaoBrowser\/([^\s;]*)/gi.test(p)?(o="taobao",r=RegExp.$1):/Firefox\/([^\s;]*)/gi.test(p)?(o="firefox",r=RegExp.$1):/Opera|opr\/([^\s;]*)/gi.test(p)?(o="firefox",r=RegExp.$1):/msie\s([^\s;]*)/gi.test(p)?(o="ie",r=RegExp.$1):/Trident/gi.test(p)?(o="ie",/rv:([^\s;]*)/gi.test(p)&&(r=RegExp.$1)):/edge\/([^\s;])/gi.test(p)?(o="edge",r=RegExp.$1):/chrome\/([^\s;]*)/gi.test(p)?(o="chrome",r=RegExp.$1):/safari\/([^\s;]*)/gi.test(p)&&(o="safari",r=RegExp.$1));return{device:t,deviceVersion:n,model:o,mdetail:r.trim(),build:a}}(p.split(/[ ]\(|\)[ ]/)[1]),n=function(e){var t="",n="",i=function(){for(var e="",t=["MicroMessenger","Weibo","Qzone","QQ","NewsArticle"],n=t.length,i=0;i<n;i++)e+=0===i?t[i]:"|"+t[i];return e&&(e="\\b("+e+")/[^ ]*"),new RegExp(e)}(),o=e.match(i);if(o){var r=o[0].split("/");t=r[0],n=r[1]}return{appSrc:t,appVer:n}}(p),i="";if("MicroMessenger"===n.appSrc||"QQ"===n.appSrc||"Qzone"===n.appSrc){var o=p.match(/NetType\/[a-z0-9A-Z_]+/);null!==o&&(i=o[0].split("/")[1])}return{isWeixin:"MicroMessenger"===n.appSrc,appSrc:"MicroMessenger"===n.appSrc?"Weixin":n.appSrc,appVer:n.appVer,netType:i,device:t.device,deviceVersion:t.deviceVersion,build:t.build,model:t.model,mdetail:t.mdetail}}(),S=function(){var p={get:function(e){var t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]*)(;|$)")),n=window.localStorage||!1;if(null!=t&&(t=t[2],n))try{window.localStorage.setItem(e,t)}catch(e){}return null===t&&n&&null!=(t=window.localStorage.getItem(e))&&p.add(e,t,1e4),t?decodeURIComponent(t):null},add:function(e,t,n){var i=e+"="+encodeURIComponent(t)+";";if(0!=n){var o=new Date;o.setTime(o.getTime()+24*n*60*60*1e3),i+="expires="+o.toGMTString()}i+=";path=/",document.cookie=i;try{window.localStorage&&window.localStorage.setItem(e,t)}catch(e){}}};function e(e,t){for(var n={},i=0;i<t.length;i++){var o=new RegExp("(^|&)"+t[i]+"=([^&]*)(&|$)"),r=e.match(o),a="";null!=r&&(a=decodeURIComponent(r[2])),n[t[i]]=a}return n}var u=e(window.location.search.substr(1),["lc","sui","cnl","cnltype","from","actid","stepid","testsdk","producttype","qz_gdt","gdt_vid","mkcloudsdk","appSrc","demostrator","openGId"]);function l(e,t){if("object"===(void 0===t?"undefined":_typeof(t)))for(var n in t)t[n]&&(e[n]=t[n])}function f(e){var t="",n=!1;for(var i in e)n&&e[i]&&(t+="&"),e[i]&&(t+=i+"="+e[i]),!n&&e[i]&&(n=!0);return t}function i(){var e=T.device;return"android"===e||"iphone"===e||"ipad"===e||"WP"===e}var t,n,o,r=(t="mousedown",n="mousemove",o="mouseup",i()&&(t="touchstart",n="touchmove",o="touchend"),{downEvent:t,moveEvent:n,upEvent:o});return{cookieHandler:p,getParaObj:e,urlPara:u,pushEvent:function(e,t,n,i,o){var r,a,s;if(a=o?"https://sdkapi.fibodata.com/rabbitForm":e?"unloadfixed"===e?v:h:g,l(r=i&&"object"===(void 0===i?"undefined":_typeof(i))?i:{},{pfid:m.pfid,appid:m.appid,mpid:m.mpid,openid:m.openid,unionid:m.unionid,apptype:m.apptype||"NULL",userid:m.userid,audid:m.audid,actid:u.actid,stepid:u.stepid,cnl:u.cnl,sui:u.sui,cnltype:u.cnltype,rp:null==p.get("rp")?"":p.get("rp"),intid:m.intid,ext:null==p.get("ext")?"":p.get("ext"),eventtype:"unloadfixed"===e?"":e}),(m.function||""===m.function)&&S.addParaToObj(r,{function:m.function}),t=JSON.stringify(t),(s=f(r))&&(a+="?"+s),1==+u.demostrator||"true"===u.demostrator){var c,d=window.RP_GLOBAL_APIS&&window.RP_GLOBAL_APIS.fireEvent;try{c={qs:s,body:JSON.parse(t)}}catch(e){c={qs:s,body:t}}d&&d("RP_RENDERER_PUSH_FIBO_DATA",c)}return"unload"===e||"exit"===e?(a+="&eventargs="+t,void((new Image).src=a)):new E(function(n,e){(new b).post(a,t,"json","application/json",null,function(e){n(e)},function(e,t){n(e||{code:t})})})},pushAction:function(e){var t="",n="",i=u.qz_gdt,o=u.gdt_vid;if(i?(t="qz_gdt",n=i):o&&(t="gdt_vid",n=o),!n||"linkclick"!==e&&"formInfo"!==e)return new E(function(e,t){e("广电通")});var r={url:encodeURIComponent(location.href),eventtype:e,click_type:t,click_id:n};return new E(function(t,e){(new b).get("https://sdkapi.fibodata.com/tsa/userActions/add",r,"json",null,function(e){t(e)},function(e){t(e)})})},addParaToUrl:function(e,t,n){return null!=n&&null!=n||(n=""),-1!=e.indexOf("?")||-1!=e.indexOf("=")?e+"&"+t+"="+n:e+"?"+t+"="+n},addParaToObj:l,objToQuery:f,isNotEmptyObj:function(e){return null!==e&&"object"===(void 0===e?"undefined":_typeof(e))&&(!Object.keys||0!==Object.keys(e).length)},isFunction:function(e){return e&&"function"==typeof e},isFiboOpenid:function(e){return e&&"string"==typeof e&&"o7kepw"===e.slice(0,6)},generateUUID:function(){var e,t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),n=[],i=t.length;for(e=0;e<30;e++)n[e]=t[0|Math.random()*i];return n.join("")},isMobile:i,isIphone:function(){var e=T.device;return"iphone"===e||"ipad"===e},getParamsFromMouseEvent:function(e){var t=e,n=document.scrollingElement;return i()&&(t=e.changedTouches[0]),{onPercentage:((n.scrollTop+innerHeight)/n.scrollHeight).toFixed(2),screenx:(t.pageX/n.scrollWidth).toFixed(2),screeny:(t.pageY/n.scrollHeight).toFixed(2)}},eventName:r}}(),k=(n=[],{add:function(e){"function"==typeof e&&(!0===o?e():n.push(e))},fire:function(){for(;0<n.length;)n.shift()()}});"true"===S.urlPara.testsdk.toString()&&(h="https://sdkapi.fibodata.com/testlog",g="https://sdkapi.fibodata.com/testlogs",v="https://sdkapi.fibodata.com/testdelayLogs",i="//kwtcdn.killerwhale.cn/mkcloudsdk/js/card.js"),window.addEventListener&&(S.isIphone()?k.add(j):window.addEventListener("unload",function(){var e;e={staytm:(new Date).getTime()-r},S.pushEvent("unload",e)},!1)),"namecard"===(e=S.urlPara).mkcloudsdk&&e.cnl&&e.cnltype&&function(e,t,n){var i=document.querySelector("script[src*='"+e+"']"),o=n||window;if(i)return S.isFunction(t)&&t.call(o,i);(i=document.createElement("script")).setAttribute("type","text/javascript"),S.isFunction(t)&&(i.onload=function(){this.onload=null,t.call(o,this)}),i.setAttribute("src",e),document.querySelector("head").appendChild(i)}(location.protocol+i);var O={};function R(e){var t,i,o=e||{},r=e.preInitUrl||u;return o.userInfo&&(i=o.userInfo,delete o.userInfo),S.addParaToObj(m,{pfid:o.pfid||"",appid:o.appid||"",mpid:o.mpid||"",openid:o.openid||"",unionid:o.unionid||i&&i.unionid,apptype:o.apptype||"NULL",userid:o.userid,rabbitOpenid:o.rabbitOpenid||"",rabbitUnionid:o.rabbitUnionid||"",rp:null==S.cookieHandler.get("rp")?"":S.cookieHandler.get("rp"),ext:null==S.cookieHandler.get("ext")?"":S.cookieHandler.get("ext")}),(t=S.objToQuery(m))&&(r+="?"+t),O=m,new E(function(t,n){(new b).get(r,{},"json",5e3,function(e){if(!e||!e.data)return t({});I(e.data,o),P(i),t(e.data)},function(e){I({},o),P(i),n(e)})})}function I(e,t){o=!0,function(e,t){var n,i,o,r,a;n=e.rp||"",i=e.intid||S.generateUUID(),o=e.ext||S.cookieHandler.get("ext")||"",r=e.openid||t.openid||"",a=e.audid||"",n?S.cookieHandler.add("rp",n,1e4):S.cookieHandler.get("rp")||S.cookieHandler.add("rp",S.generateUUID());S.addParaToObj(m,{intid:i,audid:a}),S.isFiboOpenid(o)?S.cookieHandler.add("ext",o,1e4):S.addParaToObj(m,{openid:o});S.isFiboOpenid(r)?S.cookieHandler.add("ext",r,1e4):S.addParaToObj(m,{openid:r})}(e,t),l.length&&(S.pushEvent("",l),l=[]),k.fire(),e&&S.addParaToObj(m,{function:e.function||""})}function P(e){a=(new Date).getTime();var t={isWeixin:T.isWeixin,useragent:T.device,uaVer:T.deviceVersion,lc:parseInt(S.urlPara.lc,10)||0,shareType:S.urlPara.from,netType:T.netType,appSrc:S.urlPara.appSrc||T.appSrc,appVer:T.appVer,screen:x,model:T.model,mdetail:T.mdetail,build:T.build,rurl:document.referrer,url:location.href,title:document.title,openGId:S.urlPara.openGId||""};e&&(t.userInfo=e),"groupmessage"!==t.shareType&&"singlemessage"!==t.shareType&&"timeline"!==t.shareType&&(t.shareType="");var n=document.referrer;-1==n.indexOf("mp.weixin.qq.com")&&-1==n.indexOf("mp.weixinbridge.com")||(t.shareType="gzh");var i=[];t&&i.push({t:"view",v:t}),e&&i.push({t:"userinfo",v:e}),S.pushEvent("",i)}function _(e){var t,n=s;return void 0===e||isNaN(e)||e<0||(n=e),t=(new Date).getTime(),{currentPage:n,totalPage:p,staytm:t-a}}function j(){var e,t,n=1e3,i=1,o=(new Date).getTime()-r;1e4<=o&&(n=5e3,i=5),e=[{t:"unload",v:{staytm:o+=n}}],(0<s||0<d)&&((t=_(d)).staytm+=n,e.push({t:"exit",v:t})),S.pushEvent("unloadfixed",e,null,{delay:i}),setTimeout(j,n)}function U(t){var e=t||location.href;try{var n="";if(-1!=e.indexOf("#")){var i=e.split("#");n=i[1],e=i[0]}var o=encodeURIComponent(S.urlPara.lc),r="",a=encodeURIComponent(S.urlPara.cnl||"");return o=""===o?1:parseInt(o,10)+1,(isNaN(o)||0===o)&&(o=1),null===(r=encodeURIComponent(S.cookieHandler.get("rp")))&&(r=S.generateUUID(),S.cookieHandler.add("rp",r,1e4)),e=-1!=(e=-1!=e.indexOf("lc=")?e.replace(/lc=\d{1,5}/,"lc="+o):S.addParaToUrl(e,"lc",o)).indexOf("sui=")?e.replace(/sui=[^&]+/,"sui="+r):S.addParaToUrl(e,"sui",r),""!==a&&(e=-1===e.indexOf("cnl=")?S.addParaToUrl(e,"cnl",a):e.replace(/cnl=[^&]+/,"cnl="+a)),""!=n&&(e+="#"+n),e}catch(e){return t}}return{init:R,preInit:function(e){return e.preInitUrl="https://sdkapi.fibodata.com/preInit",R(e)},share:function(e){var t={staytm:(new Date).getTime()-a,useragent:T.device,title:document.title};/^(timeline|friend|qq|txweibo|qzone)$/.test(e)&&(t.shareType=e),S.pushEvent("share",t)},btnClick:function(e,t,n){n=n||"NULL",e=e.toString(),t=t.toString();var i=e.replace(/[#&]/g,"_"),o=t.replace(/[#&]/g,"_");try{var r=event||window.event,a=r&&(r.target||r.srcElement);if(a&&"A"===a.tagName&&/^http/.test(a.href)){var s=a.href;r.preventDefault?r.preventDefault():r.returnValue=!1,E.all([S.pushAction("linkclick"),S.pushEvent("linkclick",{btname:i,remark:o,type:n})]).then(function(){location.href=s},function(){location.href=s})}else E.all([S.pushAction("linkclick"),S.pushEvent("linkclick",{btname:i,remark:o,type:n})])}catch(e){}},opState:function(e){var t=e.operation,n=e.ownerOpenid;return S.pushEvent("opState",{operation:t,ownerOpenid:n})},saveFormInfo:function(e,t,n){void 0===t&&(t="1"),n=void 0===n?"formInfo":n,e.data?E.all([S.pushAction("formInfo"),S.pushEvent(n,{formInfo:e})]):S.isNotEmptyObj(e)&&E.all([S.pushAction("formInfo"),S.pushEvent(n,{formInfo:{data:e,version:t}})])},saveFormInfoForRabbit:function(e,t){void 0===t&&(t="1");var n=e.formInfo;return!n.data&&S.isNotEmptyObj(n)&&(e.formInfo={data:n,version:t}),S.pushAction("formInfo"),S.pushEvent("formInfo",e,null,null,!0)},switchPage:function(e,t,n){if(!(isNaN(e)||isNaN(t)||isNaN(n)||e<=0||t<=0||n<=0||n<e||n<t||e==t)){var i=(new Date).getTime(),o=i-a;if(a=i,!(o<0)){var r={ctp:e,tgp:t,ttp:n,staytm:o};s=e,d=t,p||(p=n),S.pushEvent("switchpage",r)}}},dealUrl:U,preShareUrl:U,exitPage:function(e){var t;if(S.isIphone())return!1;t=_(e),S.pushEvent("exit",t)},getInitOptions:function(){return O}}}();